<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bell Timer</title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(-45deg, #0b2a5b, #1e3a8a, #0b2a5b);
      background-size: 400% 400%;
      animation: bgMove 20s ease infinite;
      color: #ffffff;
    }

    @keyframes bgMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .wrap {
      height: 100vh;
      display: grid;
      place-items: center;
      padding: 12px;
      box-sizing: border-box;
    }

    .card {
      width: min(1100px, 98vw);
      height: calc(100vh - 24px);
      max-height: calc(100vh - 24px);
      overflow: auto;
      -webkit-overflow-scrolling: touch;

      background: rgba(5,20,50,0.85);
      border-radius: 24px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      padding: 12px;
      display: grid;
      grid-template-rows: 1fr auto auto;
      gap: 10px;
      box-sizing: border-box;
    }

    .stack {
      display: grid;
      grid-template-rows:
        minmax(70px, 0.45fr)
        minmax(70px, 0.45fr)
        minmax(520px, 4.1fr);
      gap: 10px;
      min-height: 0;
    }

    .tile {
      background: linear-gradient(180deg, #0b2a5b, #071a36);
      border-radius: 18px;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.12),
        0 14px 30px rgba(0,0,0,0.60);
      padding: 12px;
      display: grid;
      place-items: center;
      text-align: center;
      box-sizing: border-box;
      min-height: 0;
    }

    .logoTile {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logoTile img {
      height: clamp(95px, 14vh, 175px);
      max-width: 100%;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.6));
    }

    .statusTile {
      display: grid;
      gap: 6px;
      align-content: center;
      justify-items: center;
      padding: 10px 12px;
      min-height: 0;
    }

    .statusLabel {
      font-size: clamp(13px, 1.9vh, 18px);
      color: #ffffff;
      letter-spacing: 0.05em;
    }

    .statusValue {
      font-size: clamp(34px, 5.5vh, 62px);
      font-weight: 950;
      color: #ffffff;
      text-shadow: 0 6px 16px rgba(0,0,0,0.65);
      line-height: 1;
      white-space: nowrap;
    }

    .timerCard {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 14px;
    }

    .timerLabel {
      font-size: clamp(14px, 2.0vh, 20px);
      color: #ffffff;
      letter-spacing: 0.04em;
      line-height: 1.1;
    }

    .timerValue {
      font-size: clamp(200px, 34vh, 480px);
      font-weight: 950;
      line-height: 0.86;
      color: #facc15;
      text-shadow: 0 16px 32px rgba(0,0,0,0.78);
      animation: pulse 1.5s ease-in-out infinite;
      margin: 0;
      white-space: nowrap;
    }

    .timerSub {
      font-size: clamp(14px, 2.0vh, 22px);
      color: #ffffff;
      line-height: 1.15;
      max-width: 100%;
      overflow-wrap: anywhere;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    .periodRange {
      text-align: center;
      font-size: clamp(13px, 1.9vh, 18px);
      color: #ffffff;
      padding: 2px 10px;
      overflow-wrap: anywhere;
    }

    .bottomBar {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      padding-top: 6px;
      border-top: 1px solid rgba(255,255,255,0.20);
    }

    .btn {
      font-size: clamp(14px, 2.0vh, 18px);
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.55);
      cursor: pointer;
      font-weight: 800;
      background: rgba(11,42,91,0.90);
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.50);
    }

    .btn:active { transform: scale(0.97); }

    @media (max-width: 1024px) and (orientation: landscape) {
      .wrap { padding: 8px; }
      .card { height: calc(100vh - 16px); max-height: calc(100vh - 16px); padding: 10px; gap: 8px; }

      .stack {
        grid-template-rows:
          minmax(60px, 0.4fr)
          minmax(60px, 0.4fr)
          minmax(360px, 3.6fr);
        gap: 8px;
      }

      .tile { padding: 10px; }
      .logoTile img { height: clamp(85px, 13vh, 150px); }
      .timerCard { padding: 12px; gap: 8px; }
      .timerValue { font-size: clamp(150px, 28vh, 420px); }
      .timerSub { font-size: clamp(13px, 1.9vh, 18px); }
      .statusValue { font-size: clamp(32px, 5.0vh, 56px); }
    }

    @media (max-height: 620px) {
      .card { padding: 10px; gap: 8px; }

      .stack {
        grid-template-rows:
          minmax(55px, 0.4fr)
          minmax(55px, 0.4fr)
          minmax(300px, 3.6fr);
        gap: 8px;
      }

      .timerValue { font-size: clamp(130px, 26vh, 360px); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="stack">
        <div class="tile logoTile">
          <img src="HSATigerCircleSPIRIT.png" alt="Harmony Science Academy Tigers">
        </div>

        <div class="tile statusTile">
          <div class="statusLabel">Status</div>
          <div class="statusValue" id="statusValue"></div>
        </div>

        <div class="tile timerCard">
          <div class="timerLabel">Time remaining</div>
          <div class="timerValue" id="remainingValue">--:--</div>
          <div class="timerSub" id="nextBellValue"></div>
        </div>
      </div>

      <div class="periodRange" id="periodRange"></div>

      <div class="bottomBar">
        <button class="btn" id="switchBtn"></button>
        <button class="btn" id="soundBtn"></button>
      </div>

    </div>
  </div>

  <script>
    const toMin = (h, m) => h * 60 + m;

    const schedules = {
      "1": {
        "mon_thurs": [
          { start: toMin(7,36), end: toMin(8,33), period: 1 },
          { start: toMin(8,37), end: toMin(9,34), period: 2 },
          { start: toMin(9,38), end: toMin(10,35), period: 3 },
          { start: toMin(10,39), end: toMin(11,36), period: 4 },
          { start: toMin(11,40), end: toMin(12,10), period: 5 },
          { start: toMin(12,14), end: toMin(13,11), period: 6 },
          { start: toMin(13,15), end: toMin(14,12), period: 7 },
          { start: toMin(14,16), end: toMin(15,13), period: 8 },
          { start: toMin(15,13), end: toMin(15,45), label: "Dismissal" },
          { start: toMin(15,45), end: toMin(17,0),  label: "After-school Programs" }
        ],
        "fri": [
          { start: toMin(7,36), end: toMin(8,14), period: 1 },
          { start: toMin(8,18), end: toMin(8,56), period: 2 },
          { start: toMin(9,0),  end: toMin(9,38), period: 3 },
          { start: toMin(9,42), end: toMin(10,20), period: 4 },
          { start: toMin(10,24), end: toMin(10,54), period: 5 },
          { start: toMin(10,58), end: toMin(11,36), period: 6 },
          { start: toMin(11,40), end: toMin(12,18), period: 7 },
          { start: toMin(12,22), end: toMin(13,0),  period: 8 },
          { start: toMin(13,0),  end: toMin(13,30), label: "After School" }
        ],
        "sat": [
          { start: toMin(9,0), end: toMin(12,0), label: "Tutorials" }
        ]
      },
      "2": {
        "mon_thurs": [
          { start: toMin(7,36), end: toMin(8,33), period: 1 },
          { start: toMin(8,37), end: toMin(9,34), period: 2 },
          { start: toMin(9,38), end: toMin(10,35), period: 3 },
          { start: toMin(10,39), end: toMin(11,36), period: 4 },
          { start: toMin(11,40), end: toMin(12,37), period: 5 },
          { start: toMin(12,41), end: toMin(13,11), period: 6 },
          { start: toMin(13,15), end: toMin(14,12), period: 7 },
          { start: toMin(14,16), end: toMin(15,13), period: 8 },
          { start: toMin(15,13), end: toMin(15,45), label: "Dismissal" },
          { start: toMin(15,45), end: toMin(17,0),  label: "After-school Programs" }
        ],
        "fri": [
          { start: toMin(7,36), end: toMin(8,14), period: 1 },
          { start: toMin(8,18), end: toMin(8,56), period: 2 },
          { start: toMin(9,0),  end: toMin(9,38), period: 3 },
          { start: toMin(9,42), end: toMin(10,20), period: 4 },
          { start: toMin(10,24), end: toMin(11,2),  period: 5 },
          { start: toMin(11,6),  end: toMin(11,36), period: 6 },
          { start: toMin(11,40), end: toMin(12,18), period: 7 },
          { start: toMin(12,22), end: toMin(13,0),  period: 8 },
          { start: toMin(13,0),  end: toMin(13,30), label: "After School" }
        ],
        "sat": [
          { start: toMin(9,0), end: toMin(12,0), label: "Tutorials" }
        ]
      }
    };

    const el = (id) => document.getElementById(id);
    const switchBtn = el("switchBtn");
    const soundBtn = el("soundBtn");

    let building = localStorage.getItem("bell_building") || "2";

    let soundEnabled = (localStorage.getItem("bell_sound_enabled") || "1") === "1";
    let audioCtx = null;
    let lastBeepKey = "";

    function pad(n){ return String(n).padStart(2, "0"); }

    function formatTime(mins){
      const h = Math.floor(mins / 60);
      const m = mins % 60;
      const ampm = h >= 12 ? "PM" : "AM";
      const hh = ((h + 11) % 12) + 1;
      return `${hh}:${pad(m)} ${ampm}`;
    }

    function getDayKey(){
      const d = new Date().getDay();
      if (d === 6) return "sat";
      if (d === 5) return "fri";
      if (d === 0) return "sun";
      return "mon_thurs";
    }

    function nowMinutes(){
      const n = new Date();
      return n.getHours() * 60 + n.getMinutes() + n.getSeconds() / 60;
    }

    function updateBuildingButton(){
      switchBtn.textContent = building === "2" ? "Building 1" : "Building 2";
    }

    function updateSoundButton(){
      soundBtn.textContent = soundEnabled ? "Sound On" : "Sound Off";
    }

    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") audioCtx.resume();
    }

    function beep(){
      if (!soundEnabled) return;
      ensureAudio();
      if (!audioCtx) return;

      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "sine";
      osc.frequency.value = 880;

      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(0.22, t + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t);
      osc.stop(t + 0.13);
    }

    function maybeBeep(phase, secondsLeftInt){
      if (!soundEnabled) return;
      if (secondsLeftInt <= 0) return;

      let shouldBeep = false;
      if (phase === "period" && secondsLeftInt <= 5) shouldBeep = true;
      if (phase === "transtion" && secondsLeftInt <= 2) shouldBeep = true;
      if (!shouldBeep) return;

      const key = `${phase}_${secondsLeftInt}`;
      if (key === lastBeepKey) return;

      lastBeepKey = key;
      beep();
    }

    switchBtn.onclick = () => {
      building = building === "2" ? "1" : "2";
      localStorage.setItem("bell_building", building);
      updateBuildingButton();
      tick();
    };

    soundBtn.onclick = () => {
      soundEnabled = !soundEnabled;
      localStorage.setItem("bell_sound_enabled", soundEnabled ? "1" : "0");
      if (soundEnabled) ensureAudio();
      updateSoundButton();
    };

    function setDisplay(statusLabel, rangeText, secondsLeft, nextBellText){
      el("statusValue").textContent = statusLabel;
      el("periodRange").textContent = rangeText;
      el("remainingValue").textContent = `${Math.floor(secondsLeft / 60)}:${pad(secondsLeft % 60)}`;
      el("nextBellValue").textContent = nextBellText;
    }

    function tick(){
      const dayKey = getDayKey();

      if (dayKey === "sun") {
        setDisplay("No School", "Sunday", 0, "No bells today");
        lastBeepKey = "";
        return;
      }

      const blocks = schedules[building][dayKey];
      const nowM = nowMinutes();

      for (let i = 0; i < blocks.length; i++) {
        const b = blocks[i];
        if (nowM >= b.start && nowM < b.end) {
          const secondsLeft = Math.max(0, Math.floor((b.end - nowM) * 60));
          const statusText = b.label ? b.label : `P ${b.period}`;
          setDisplay(
            statusText,
            `${formatTime(b.start)} to ${formatTime(b.end)}`,
            secondsLeft,
            `Next bell at ${formatTime(b.end)}`
          );
          maybeBeep("period", secondsLeft);
          return;
        }
      }

      if (nowM < blocks[0].start) {
        const secondsLeft = Math.max(0, Math.floor((blocks[0].start - nowM) * 60));
        setDisplay(
          "Before School",
          `First bell at ${formatTime(blocks[0].start)}`,
          secondsLeft,
          `Next bell at ${formatTime(blocks[0].start)}`
        );
        lastBeepKey = "";
        return;
      }

      for (let i = 0; i < blocks.length - 1; i++) {
        if (nowM >= blocks[i].end && nowM < blocks[i + 1].start) {
          const secondsLeft = Math.max(0, Math.floor((blocks[i + 1].start - nowM) * 60));
          const nextName = blocks[i + 1].label ? blocks[i + 1].label : `P ${blocks[i + 1].period}`;
          setDisplay(
            "Transtion",
            `Next: ${nextName}`,
            secondsLeft,
            `Next bell at ${formatTime(blocks[i + 1].start)}`
          );
          maybeBeep("transtion", secondsLeft);
          return;
        }
      }

      setDisplay(
        "After School",
        "Schedule finished",
        0,
        "No more bells today"
      );
      lastBeepKey = "";
    }

    updateBuildingButton();
    updateSoundButton();
    tick();
    setInterval(tick, 250);
  </script>
</body>
</html>
