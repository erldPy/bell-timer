<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bell Timer</title>

  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="94x94" href="favicon-94.png">

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    body{
      margin: 0;
      min-height: 100dvh;
      color: #ffffff;

      background: linear-gradient(-45deg,
        #0b2a5b,
        #7c3aed,
        #ef4444,
        #22c55e,
        #06b6d4,
        #0b2a5b
      );
      background-size: 500% 500%;
      animation: bgMove 45s linear infinite;
    }

    @keyframes bgMove{
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .wrap{
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 12px;
      box-sizing: border-box;
    }

    .card{
      width: min(1100px, 98vw);
      height: calc(100dvh - 24px);
      max-height: calc(100dvh - 24px);
      overflow: auto;
      -webkit-overflow-scrolling: touch;

      background: rgba(5,20,50,0.85);
      border-radius: 24px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      padding: 12px;

      display: grid;
      grid-template-rows: 1fr auto;
      gap: 10px;
      box-sizing: border-box;
    }

    .stack{
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 10px;
      min-height: 0;
    }

    .tile{
      background: linear-gradient(180deg, #1f2933, #111827);
      border-radius: 18px;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.12),
        0 14px 30px rgba(0,0,0,0.60);
      padding: 12px;
      display: grid;
      place-items: center;
      text-align: center;
      box-sizing: border-box;
      min-height: 0;
    }

    .statusTile{
      display: grid;
      align-content: center;
      justify-items: center;
      padding: 6px 12px;
      min-height: 56px;
    }

    .statusValue{
      font-size: clamp(34px, 5.5vh, 62px);
      font-weight: 950;
      color: #ffffff;
      text-shadow: 0 6px 16px rgba(0,0,0,0.65);
      line-height: 1;
      white-space: nowrap;
    }

    .timerCard{
      position: relative;
      overflow: hidden;
      padding: 0;
      display: block;
      min-height: 220px;
    }

    .timerLabel{
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(12px, 1.6vh, 16px);
      margin: 0;
      z-index: 3;
      pointer-events: none;
      white-space: nowrap;
    }

    .timerValue{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);

      font-size: clamp(120px, min(40vh, 70vw), 560px);
      font-weight: 950;
      line-height: 0.78;
      color: #facc15;
      text-shadow: 0 16px 32px rgba(0,0,0,0.78);
      white-space: nowrap;
      margin: 0;
      z-index: 1;
      pointer-events: none;
    }

    .timerSub{
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(12px, 1.6vh, 16px);
      margin: 0;
      text-align: center;
      width: calc(100% - 24px);
      z-index: 3;
      pointer-events: none;
    }

    .timerCard.noTimer .timerValue{ display: none; }
    .timerCard.noTimer .timerLabel{ top: 14px; }
    .timerCard.noTimer .timerSub{
      top: 50%;
      bottom: auto;
      transform: translate(-50%, -50%);
      font-size: clamp(18px, 2.4vh, 26px);
      width: calc(100% - 24px);
    }

    .periodRange{
      text-align: center;
      font-size: clamp(13px, 1.9vh, 18px);
      color: #ffffff;
      padding: 2px 10px;
      overflow-wrap: anywhere;
    }

    .logoTile{
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logoBottom{
      margin-top: 6px;
      padding: 8px;
    }

    .logoBottom img{
      height: clamp(70px, 10vh, 120px);
      max-width: 100%;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.6));
      opacity: 0.95;
    }

    .bottomBar{
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      padding-top: 6px;
      border-top: 1px solid rgba(255,255,255,0.20);
    }

    .btn{
      font-size: clamp(14px, 2.0vh, 18px);
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.55);
      cursor: pointer;
      font-weight: 800;
      background: linear-gradient(180deg, #1f2933, #111827);
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.50);
    }

    .btn:active{ transform: scale(0.97); }
    .btn:hover{ filter: brightness(1.15); }

    @media (max-height: 700px){
      .timerCard{ min-height: 180px; }
      .timerValue{ font-size: clamp(100px, min(34vh, 78vw), 460px); }
    }

    @media (max-height: 560px){
      .timerLabel{ display: none; }
      .timerCard{ min-height: 160px; }
      .timerValue{ font-size: clamp(90px, min(32vh, 82vw), 420px); }
      .timerSub{ bottom: 8px; }
    }

    @media (max-height: 520px) and (orientation: landscape){
      .stack{ gap: 6px; }
      .statusTile{ padding: 4px 10px; }
      .statusValue{ font-size: clamp(22px, 4.2vh, 40px); }

      .timerLabel{ display: none; }
      .timerCard{ min-height: 140px; }
      .timerValue{
        top: 52%;
        font-size: clamp(110px, min(48vh, 72vw), 480px);
        line-height: 0.74;
      }

@media (min-width: 700px) and (max-width: 1100px){
  .stack{ grid-template-rows: auto 1fr; }
  .timerCard{ min-height: 300px; }
}



      .periodRange{
        font-size: 12px;
        padding: 0;
        margin: 0;
      }

      .logoBottom img{ height: 52px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="stack">
        <div class="tile statusTile">
          <div class="statusValue" id="statusValue"></div>
        </div>

        <div class="tile timerCard">
          <div class="timerLabel">Time remaining</div>
          <div class="timerValue" id="remainingValue">--:--</div>
          <div class="timerSub" id="nextBellValue"></div>
        </div>
      </div>

      <div class="periodRange" id="periodRange"></div>

      

      <div class="bottomBar">
        <button class="btn" id="switchBtn"></button>
        <button class="btn" id="soundBtn"></button>
      </div>

    </div>
  </div>

  <script>
    const toMin = (h, m) => h * 60 + m;

    const schedules = {
      "1": {
        "mon_thurs": [
          { start: toMin(7,36), end: toMin(8,33), period: 1 },
          { start: toMin(8,37), end: toMin(9,34), period: 2 },
          { start: toMin(9,38), end: toMin(10,35), period: 3 },
          { start: toMin(10,39), end: toMin(11,36), period: 4 },
          { start: toMin(11,40), end: toMin(12,10), period: 5 },
          { start: toMin(12,14), end: toMin(13,11), period: 6 },
          { start: toMin(13,15), end: toMin(14,12), period: 7 },
          { start: toMin(14,16), end: toMin(15,13), period: 8 },
          { start: toMin(15,13), end: toMin(15,45), label: "Dismissal" },
          { start: toMin(15,45), end: toMin(17,0),  label: "After-school Programs" }
        ],
        "fri": [
          { start: toMin(7,36), end: toMin(8,14), period: 1 },
          { start: toMin(8,18), end: toMin(8,56), period: 2 },
          { start: toMin(9,0),  end: toMin(9,38), period: 3 },
          { start: toMin(9,42), end: toMin(10,20), period: 4 },
          { start: toMin(10,24), end: toMin(10,54), period: 5 },
          { start: toMin(10,58), end: toMin(11,36), period: 6 },
          { start: toMin(11,40), end: toMin(12,18), period: 7 },
          { start: toMin(12,22), end: toMin(13,0),  period: 8 },
          { start: toMin(13,0),  end: toMin(13,30), label: "After School" }
        ],
        "sat": [
          { start: toMin(9,0), end: toMin(12,0), label: "Tutorials" }
        ]
      },
      "2": {
        "mon_thurs": [
          { start: toMin(7,36), end: toMin(8,33), period: 1 },
          { start: toMin(8,37), end: toMin(9,34), period: 2 },
          { start: toMin(9,38), end: toMin(10,35), period: 3 },
          { start: toMin(10,39), end: toMin(11,36), period: 4 },
          { start: toMin(11,40), end: toMin(12,37), period: 5 },
          { start: toMin(12,41), end: toMin(13,11), period: 6 },
          { start: toMin(13,15), end: toMin(14,12), period: 7 },
          { start: toMin(14,16), end: toMin(15,13), period: 8 },
          { start: toMin(15,13), end: toMin(15,45), label: "Dismissal" },
          { start: toMin(15,45), end: toMin(17,0),  label: "After-school Programs" }
        ],
        "fri": [
          { start: toMin(7,36), end: toMin(8,14), period: 1 },
          { start: toMin(8,18), end: toMin(8,56), period: 2 },
          { start: toMin(9,0),  end: toMin(9,38), period: 3 },
          { start: toMin(9,42), end: toMin(10,20), period: 4 },
          { start: toMin(10,24), end: toMin(11,2),  period: 5 },
          { start: toMin(11,6),  end: toMin(11,36), period: 6 },
          { start: toMin(11,40), end: toMin(12,18), period: 7 },
          { start: toMin(12,22), end: toMin(13,0),  period: 8 },
          { start: toMin(13,0),  end: toMin(13,30), label: "After School" }
        ],
        "sat": [
          { start: toMin(9,0), end: toMin(12,0), label: "Tutorials" }
        ]
      }
    };

    const el = (id) => document.getElementById(id);
    const switchBtn = el("switchBtn");
    const soundBtn = el("soundBtn");

    let building = localStorage.getItem("bell_building") || "2";
    let soundEnabled = (localStorage.getItem("bell_sound_enabled") || "1") === "1";

    let audioCtx = null;
    let lastBeepKey = "";

    function pad(n){ return String(n).padStart(2, "0"); }

    function formatTime(mins){
      const h = Math.floor(mins / 60);
      const m = mins % 60;
      const ampm = h >= 12 ? "PM" : "AM";
      const hh = ((h + 11) % 12) + 1;
      return `${hh}:${pad(m)} ${ampm}`;
    }

    function getDayKey(){
      const d = new Date().getDay();
      if (d === 6) return "sat";
      if (d === 5) return "fri";
      if (d === 0) return "sun";
      return "mon_thurs";
    }

    function nowMinutes(){
      const n = new Date();
      return n.getHours() * 60 + n.getMinutes() + n.getSeconds() / 60;
    }

    function updateBuildingButton(){
      switchBtn.textContent = building === "2" ? "Show Building 1" : "Show Building 2";
    }

    function updateSoundButton(){
      soundBtn.textContent = soundEnabled ? "Sound On" : "Sound Off";
    }

    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") audioCtx.resume();
    }

    function beep(){
  if (!soundEnabled) return;
  ensureAudio();
  if (!audioCtx) return;

  const t = audioCtx.currentTime;

  // Sharper, higher pitch, louder
  const osc1 = audioCtx.createOscillator();
  const osc2 = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc1.type = "square";
  osc2.type = "sine";

  // Higher pitch
  osc1.frequency.setValueAtTime(1760, t); // A6
  osc2.frequency.setValueAtTime(2093, t); // C7

  // Slight drop to sound more like a bell chirp
  osc1.frequency.exponentialRampToValueAtTime(1320, t + 0.08);
  osc2.frequency.exponentialRampToValueAtTime(1568, t + 0.08);

  // Louder envelope
  gain.gain.setValueAtTime(0.0001, t);
  gain.gain.exponentialRampToValueAtTime(0.7, t + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.22);

  osc1.connect(gain);
  osc2.connect(gain);
  gain.connect(audioCtx.destination);

  osc1.start(t);
  osc2.start(t);
  osc1.stop(t + 0.24);
  osc2.stop(t + 0.24);
}

    function maybeBeep(phase, secondsLeftInt){
      if (!soundEnabled) return;
      if (secondsLeftInt <= 0) return;

      let shouldBeep = false;
      if (phase === "period" && secondsLeftInt <= 5) shouldBeep = true;
      if (phase === "transition" && secondsLeftInt <= 2) shouldBeep = true;
      if (!shouldBeep) return;

      const key = `${phase}_${secondsLeftInt}`;
      if (key === lastBeepKey) return;

      lastBeepKey = key;
      beep();
    }

    switchBtn.onclick = () => {
      building = building === "2" ? "1" : "2";
      localStorage.setItem("bell_building", building);
      updateBuildingButton();
      tick();
    };

    soundBtn.onclick = () => {
      soundEnabled = !soundEnabled;
      localStorage.setItem("bell_sound_enabled", soundEnabled ? "1" : "0");
      if (soundEnabled) ensureAudio();
      updateSoundButton();
    };

    function setDisplay(statusLabel, rangeText, secondsLeft, nextBellText){
      el("statusValue").textContent = statusLabel;
      el("periodRange").textContent = rangeText;

      const timerTile = document.querySelector(".timerCard");

      if (secondsLeft === null || secondsLeft === undefined) {
        timerTile.classList.add("noTimer");
        el("remainingValue").textContent = "";
      } else {
        timerTile.classList.remove("noTimer");
        const s = Math.max(0, Math.floor(secondsLeft));
        el("remainingValue").textContent = `${Math.floor(s / 60)}:${pad(s % 60)}`;
      }

      el("nextBellValue").textContent = nextBellText;
    }

    function tick(){
      const dayKey = getDayKey();

      if (dayKey === "sun") {
        setDisplay("No School", "Sunday", null, "No bells today");
        lastBeepKey = "";
        return;
      }

      const blocks = schedules[building][dayKey];
      const nowM = nowMinutes();

      for (let i = 0; i < blocks.length; i++) {
        const b = blocks[i];
        if (nowM >= b.start && nowM < b.end) {
          const secondsLeft = Math.max(0, Math.floor((b.end - nowM) * 60));
          const statusText = b.label ? b.label : `P ${b.period}`;
          setDisplay(
            statusText,
            `${formatTime(b.start)} to ${formatTime(b.end)}`,
            secondsLeft,
            `Next bell at ${formatTime(b.end)}`
          );
          maybeBeep("period", secondsLeft);
          return;
        }
      }

      if (nowM < blocks[0].start) {
        const secondsLeft = Math.max(0, Math.floor((blocks[0].start - nowM) * 60));
        setDisplay(
          "Before School",
          `First bell at ${formatTime(blocks[0].start)}`,
          secondsLeft,
          `Next bell at ${formatTime(blocks[0].start)}`
        );
        lastBeepKey = "";
        return;
      }

      for (let i = 0; i < blocks.length - 1; i++) {
        if (nowM >= blocks[i].end && nowM < blocks[i + 1].start) {
          const secondsLeft = Math.max(0, Math.floor((blocks[i + 1].start - nowM) * 60));
          const nextName = blocks[i + 1].label ? blocks[i + 1].label : `P ${blocks[i + 1].period}`;
          setDisplay(
            "Transition",
            `Next: ${nextName}`,
            secondsLeft,
            `Next bell at ${formatTime(blocks[i + 1].start)}`
          );
          maybeBeep("transition", secondsLeft);
          return;
        }
      }

      setDisplay(
        "No Classes or Activities",
        "",
        null,
        `Next school day starts at ${formatTime(blocks[0].start)}`
      );

      lastBeepKey = "";
    }

    updateBuildingButton();
    updateSoundButton();
    tick();
    setInterval(tick, 250);
  </script>
</body>
</html>
